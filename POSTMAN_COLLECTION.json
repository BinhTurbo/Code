{
  "info": {
    "name": "MiniWeb - Redis & RabbitMQ API (Fixed Auth)",
    "description": "Full API Collection vá»›i Authorization Ä‘áº§y Ä‘á»§\n\nðŸ”‘ **Authentication:**\n- Bearer Token tá»± Ä‘á»™ng gáº¯n vÃ o requests cáº§n auth\n- Run Login trÆ°á»›c Ä‘á»ƒ láº¥y token\n\nðŸŽ¯ **Test Flow:**\n1. Auth â†’ Login (láº¥y token)\n2. Test cÃ¡c endpoints khÃ¡c\n\nâš ï¸ **Note:** Token expire sau 15 phÃºt",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "ðŸ” Auth",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    pm.environment.set(\"user_id\", pm.response.json().id);",
                  "    console.log(\"âœ… User registered successfully\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"testuser\",\n  \"email\": \"testuser@example.com\",\n  \"password\": \"Test@123\",\n  \"fullName\": \"Test User\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register"]
            },
            "description": "ÄÄƒng kÃ½ user má»›i (public endpoint)"
          }
        },
        {
          "name": "Login (Get JWT Token)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.environment.set(\"jwt_token\", response.accessToken);",
                  "    pm.environment.set(\"refresh_token\", response.refreshToken);",
                  "    pm.collectionVariables.set(\"jwt_token\", response.accessToken);",
                  "    console.log(\"âœ… Token saved: \" + response.accessToken.substring(0, 20) + \"...\");",
                  "    console.log(\"â° Token expires in: 15 minutes\");",
                  "} else {",
                  "    console.error(\"âŒ Login failed\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "login"]
            },
            "description": "ðŸ”‘ **RUN FIRST!** Login Ä‘á»ƒ láº¥y JWT Token\n\n**Default Admin:**\n- Username: `admin`\n- Password: `admin123`\n\n**Token expire:** 15 minutes (tá»« jwt.access-ttl)\n\n**Auto-save:** Token tá»± Ä‘á»™ng lÆ°u vÃ o environment vÃ  collection variables"
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.environment.set(\"jwt_token\", response.accessToken);",
                  "    pm.collectionVariables.set(\"jwt_token\", response.accessToken);",
                  "    console.log(\"âœ… Token refreshed\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/refresh",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "refresh"]
            },
            "description": "Refresh access token khi háº¿t háº¡n"
          }
        }
      ],
      "description": "Authentication endpoints\n\nâš ï¸ **RUN LOGIN FIRST!**"
    },
    {
      "name": "ðŸ“¦ Products (Redis Cache Test)",
      "item": [
        {
          "name": "Get Products (Page 1) - FIRST CALL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const responseTime = pm.response.responseTime;",
                  "pm.environment.set(\"first_call_time\", responseTime);",
                  "console.log(\"â±ï¸ First call (from DB): \" + responseTime + \"ms\");",
                  "",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has products\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.content).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products?page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            },
            "description": "ðŸ¢ **FIRST CALL** - Query tá»« Database\n\n**Expected:**\n- Response time: ~100-200ms\n- Data tá»« MySQL\n- Uses Bearer Token from collection auth\n\n**Next Step:**\n- Cháº¡y \"SECOND CALL\" Ä‘á»ƒ test Redis cache"
          }
        },
        {
          "name": "Get Products (Page 1) - SECOND CALL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const responseTime = pm.response.responseTime;",
                  "const firstCallTime = pm.environment.get(\"first_call_time\");",
                  "",
                  "console.log(\"âš¡ Second call (from Redis): \" + responseTime + \"ms\");",
                  "if (firstCallTime) {",
                  "    const improvement = Math.round((1 - responseTime/firstCallTime) * 100);",
                  "    console.log(\"ðŸ“Š Performance improvement: \" + improvement + \"%\");",
                  "}",
                  "",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (firstCallTime) {",
                  "    pm.test(\"Faster than first call (Redis cache)\", function () {",
                  "        pm.expect(responseTime).to.be.below(firstCallTime);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products?page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            },
            "description": "âš¡ **SECOND CALL** - Láº¥y tá»« Redis Cache\n\n**Expected:**\n- Response time: ~5-10ms (nhanh hÆ¡n 90-95%)\n- Data tá»« Redis\n\n**Verify:**\n```bash\ndocker exec -it wedmini-redis redis-cli\nKEYS products::*\nTTL products::page=0&size=10\n```"
          }
        },
        {
          "name": "Search Products by Name",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const products = pm.response.json().content;",
                  "    if (products.length > 0) {",
                  "        pm.environment.set(\"product_id\", products[0].id);",
                  "        console.log(\"âœ… Found \" + products.length + \" products\");",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products?name=laptop&page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "products"],
              "query": [
                {
                  "key": "name",
                  "value": "laptop",
                  "description": "Search by product name"
                },
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            },
            "description": "TÃ¬m kiáº¿m sáº£n pháº©m theo tÃªn\n\n**Cache Key:**\n```\nproducts::name=laptop&page=0&size=10\n```\n\nRun 2 láº§n Ä‘á»ƒ test cache performance"
          }
        },
        {
          "name": "Get Product by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "{{product_id}}"]
            },
            "description": "Láº¥y chi tiáº¿t 1 sáº£n pháº©m\n\n**Cache:** CÃ³ (by ID)"
          }
        },
        {
          "name": "Create Product (Cache Eviction)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    pm.environment.set(\"new_product_id\", pm.response.json().id);",
                  "    console.log(\"âœ… Product created: ID = \" + pm.response.json().id);",
                  "    console.log(\"ðŸ—‘ï¸ Cache evicted: products::*\");",
                  "    console.log(\"ðŸ’¡ Run 'Get Products' again to see fresh data from DB\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Laptop Dell XPS 15 2024\",\n  \"description\": \"High performance laptop for developers\",\n  \"price\": 35000000,\n  \"stock\": 10,\n  \"status\": \"ACTIVE\",\n  \"categoryId\": {{category_id}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            },
            "description": "ðŸ—‘ï¸ **Cache Eviction Test**\n\n**Flow:**\n1. Create product\n2. `@CacheEvict(value = \"products\", allEntries = true)`\n3. All product cache cleared\n\n**After this:**\n- Run \"Get Products\" again\n- First call will be slow (DB query)\n- Second call will be fast (Redis)\n\n**Note:** Requires Bearer Token (auto from collection auth)"
          }
        },
        {
          "name": "Update Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log(\"âœ… Product updated\");",
                  "    console.log(\"ðŸ—‘ï¸ Cache evicted\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Laptop Dell XPS 15 2024 (Updated)\",\n  \"description\": \"Updated description\",\n  \"price\": 32000000,\n  \"stock\": 8,\n  \"status\": \"ACTIVE\",\n  \"categoryId\": {{category_id}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products/{{new_product_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "{{new_product_id}}"]
            },
            "description": "Cáº­p nháº­t sáº£n pháº©m â†’ Cache bá»‹ xÃ³a"
          }
        },
        {
          "name": "Delete Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 204 || pm.response.code === 200) {",
                  "    console.log(\"âœ… Product deleted\");",
                  "    console.log(\"ðŸ—‘ï¸ Cache evicted\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products/{{new_product_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "{{new_product_id}}"]
            },
            "description": "XÃ³a sáº£n pháº©m â†’ Cache bá»‹ xÃ³a"
          }
        }
      ],
      "description": "Test Redis Cache Performance\n\nâš ï¸ **Requires Bearer Token** (auto from collection)"
    },
    {
      "name": "ðŸ“ Categories (RabbitMQ Test)",
      "item": [
        {
          "name": "Get Categories",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const categories = pm.response.json().content;",
                  "    if (categories.length > 0) {",
                  "        pm.environment.set(\"category_id\", categories[0].id);",
                  "        console.log(\"âœ… Found \" + categories.length + \" categories\");",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/categories?page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "categories"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            },
            "description": "Láº¥y danh sÃ¡ch categories\n\n**Cache:** CÃ³ (TTL 10 phÃºt)"
          }
        },
        {
          "name": "Get Category by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/categories/{{category_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "categories", "{{category_id}}"]
            },
            "description": "Láº¥y chi tiáº¿t 1 category\n\n**Cache:** CÃ³"
          }
        },
        {
          "name": "Create Category (RabbitMQ Email)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    const category = pm.response.json();",
                  "    pm.environment.set(\"new_category_id\", category.id);",
                  "    console.log(\"âœ… Category created: ID = \" + category.id);",
                  "    console.log(\"ðŸ“¤ RabbitMQ message sent: category.created\");",
                  "    console.log(\"ðŸ“§ Check backend log for email\");",
                  "    console.log(\"\");",
                  "    console.log(\"Expected log:\");",
                  "    console.log(\"  ðŸ“¤ ÄÃ£ gá»­i message: Category created\");",
                  "    console.log(\"  ðŸ“¥ Nháº­n message: ...\");",
                  "    console.log(\"  ðŸ“§ ÄÃ£ gá»­i email Ä‘áº¿n: binhturbo2002@gmail.com\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Laptop Gaming {{$timestamp}}\",\n  \"description\": \"High-end gaming laptops with RGB lighting\",\n  \"status\": \"ACTIVE\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/categories",
              "host": ["{{base_url}}"],
              "path": ["api", "categories"]
            },
            "description": "ðŸ“§ **RabbitMQ Email Test**\n\n**Flow:**\n1. POST /api/categories\n2. CategoryService â†’ RabbitMQ: `category.created`\n3. CategoryEventListener nháº­n message\n4. EmailService gá»­i email\n\n**Check:**\n\n1. **Backend Log:**\n```\nðŸ“¤ ÄÃ£ gá»­i message: Category created\nðŸ“¥ Nháº­n message: ...\nðŸ“§ ÄÃ£ gá»­i email Ä‘áº¿n: binhturbo2002@gmail.com\n```\n\n2. **RabbitMQ UI:** http://localhost:15672\n   - Username: admin\n   - Password: admin123\n   - Tab **Queues** â†’ `category.queue`\n   - Tab **Exchanges** â†’ `category.exchange`\n\n3. **Email Inbox:** Check `binhturbo2002@gmail.com`\n\n**Note:** Email cÃ³ thá»ƒ vÃ o Spam náº¿u láº§n Ä‘áº§u gá»­i"
          }
        },
        {
          "name": "Update Category Status (RabbitMQ + Cascade Update)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log(\"âœ… Category status updated to INACTIVE\");",
                  "    console.log(\"ðŸ“¤ RabbitMQ: category.status.changed\");",
                  "    console.log(\"ðŸ”„ All products in this category â†’ INACTIVE\");",
                  "    console.log(\"ðŸ“§ Email sent with affected product count\");",
                  "    console.log(\"\");",
                  "    console.log(\"Expected log:\");",
                  "    console.log(\"  ðŸ”„ Xá»­ lÃ½ event: Category status changed\");",
                  "    console.log(\"  ðŸ” TÃ¬m tháº¥y X sáº£n pháº©m\");",
                  "    console.log(\"  âœ… ÄÃ£ cáº­p nháº­t X sáº£n pháº©m sang INACTIVE\");",
                  "    console.log(\"  ðŸ“§ ÄÃ£ gá»­i email: X products affected\");",
                  "    console.log(\"\");",
                  "    console.log(\"Verify in database:\");",
                  "    console.log(\"  SELECT * FROM categories WHERE id = \" + pm.environment.get(\"new_category_id\") + \";\");",
                  "    console.log(\"  SELECT * FROM products WHERE category_id = \" + pm.environment.get(\"new_category_id\") + \";\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Laptop Gaming (Discontinued)\",\n  \"description\": \"This category has been discontinued\",\n  \"status\": \"INACTIVE\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/categories/{{new_category_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "categories", "{{new_category_id}}"]
            },
            "description": "ðŸ”„ **RabbitMQ Cascade Update Test**\n\n**Setup:**\n1. Run \"Create Category\"\n2. Create 2-3 products trong category Ä‘Ã³ (status=ACTIVE)\n3. Run request nÃ y\n\n**Flow:**\n1. PUT /api/categories/{id} vá»›i status=INACTIVE\n2. CategoryService â†’ RabbitMQ: `category.status.changed`\n3. CategoryEventListener:\n   - TÃ¬m all products cÃ³ category_id = {id}\n   - Update táº¥t cáº£ products â†’ status=INACTIVE\n   - Gá»­i email vá»›i sá»‘ lÆ°á»£ng products bá»‹ áº£nh hÆ°á»Ÿng\n\n**Verify:**\n\n```sql\n-- Check category\nSELECT * FROM categories WHERE id = {{new_category_id}};\n-- status should be INACTIVE\n\n-- Check products\nSELECT * FROM products WHERE category_id = {{new_category_id}};\n-- All status should be INACTIVE\n```\n\n**Backend Log:**\n```\nðŸ”„ Xá»­ lÃ½ event: Category status changed\nðŸ” TÃ¬m tháº¥y 3 sáº£n pháº©m\nâœ… ÄÃ£ cáº­p nháº­t 3 sáº£n pháº©m sang INACTIVE\nðŸ“§ ÄÃ£ gá»­i email: 3 products affected\n```"
          }
        },
        {
          "name": "Delete Category",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 204 || pm.response.code === 200) {",
                  "    console.log(\"âœ… Category deleted\");",
                  "    console.log(\"ðŸ—‘ï¸ Cache evicted\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/categories/{{new_category_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "categories", "{{new_category_id}}"]
            },
            "description": "XÃ³a category â†’ Cache bá»‹ xÃ³a"
          }
        }
      ],
      "description": "Test RabbitMQ Messaging & Email\n\nâš ï¸ **Requires Bearer Token**"
    },
    {
      "name": "ðŸ” Verify & Debug",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/actuator/health",
              "host": ["{{base_url}}"],
              "path": ["actuator", "health"]
            },
            "description": "Check health:\n- Application\n- Database\n- Redis\n- RabbitMQ"
          }
        }
      ]
    },
    {
      "name": "ðŸ§ª Full Test Flow (Run in Order)",
      "item": [
        {
          "name": "STEP 1: Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Login successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.environment.set(\"jwt_token\", response.accessToken);",
                  "    pm.collectionVariables.set(\"jwt_token\", response.accessToken);",
                  "    console.log(\"âœ… Step 1: Login OK\");",
                  "    console.log(\"ðŸ”‘ Token: \" + response.accessToken.substring(0, 30) + \"...\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "STEP 2: Create Category + Email",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Category created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "    const category = pm.response.json();",
                  "    pm.environment.set(\"test_category_id\", category.id);",
                  "    console.log(\"âœ… Step 2: Category created, ID = \" + category.id);",
                  "    console.log(\"ðŸ“§ Check backend log for email notification\");",
                  "});",
                  "",
                  "setTimeout(function(){}, 2000);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Category {{$timestamp}}\",\n  \"description\": \"Testing RabbitMQ & Email\",\n  \"status\": \"ACTIVE\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/categories",
              "host": ["{{base_url}}"],
              "path": ["api", "categories"]
            }
          }
        },
        {
          "name": "STEP 3: Create Product 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Product 1 created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "    pm.environment.set(\"test_product_1_id\", pm.response.json().id);",
                  "    console.log(\"âœ… Step 3a: Product 1 created\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Product 1 {{$timestamp}}\",\n  \"description\": \"Testing product 1\",\n  \"price\": 1000000,\n  \"stock\": 10,\n  \"status\": \"ACTIVE\",\n  \"categoryId\": {{test_category_id}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            }
          }
        },
        {
          "name": "STEP 3: Create Product 2",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Product 2 created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "    pm.environment.set(\"test_product_2_id\", pm.response.json().id);",
                  "    console.log(\"âœ… Step 3b: Product 2 created\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Product 2 {{$timestamp}}\",\n  \"description\": \"Testing product 2\",\n  \"price\": 2000000,\n  \"stock\": 20,\n  \"status\": \"ACTIVE\",\n  \"categoryId\": {{test_category_id}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            }
          }
        },
        {
          "name": "STEP 3: Create Product 3",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Product 3 created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "    pm.environment.set(\"test_product_3_id\", pm.response.json().id);",
                  "    console.log(\"âœ… Step 3c: Product 3 created\");",
                  "    console.log(\"ðŸ“¦ Total: 3 products created\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Product 3 {{$timestamp}}\",\n  \"description\": \"Testing product 3\",\n  \"price\": 3000000,\n  \"stock\": 30,\n  \"status\": \"ACTIVE\",\n  \"categoryId\": {{test_category_id}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            }
          }
        },
        {
          "name": "STEP 4: Get Products - First Call (Cache Test)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const responseTime = pm.response.responseTime;",
                  "pm.environment.set(\"test_first_call_time\", responseTime);",
                  "console.log(\"âœ… Step 4a: First call = \" + responseTime + \"ms (from DB)\");",
                  "console.log(\"ðŸ’¡ Run STEP 4b to see Redis cache performance\");"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products?page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "STEP 4: Get Products - Second Call (Cache Test)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const responseTime = pm.response.responseTime;",
                  "const firstCallTime = pm.environment.get(\"test_first_call_time\");",
                  "",
                  "console.log(\"âœ… Step 4b: Second call = \" + responseTime + \"ms (from Redis)\");",
                  "",
                  "if (firstCallTime) {",
                  "    const improvement = Math.round((1 - responseTime/firstCallTime) * 100);",
                  "    console.log(\"ðŸ“Š Performance: \" + improvement + \"% faster!\");",
                  "    console.log(\"   First:  \" + firstCallTime + \"ms (DB)\");",
                  "    console.log(\"   Second: \" + responseTime + \"ms (Redis)\");",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products?page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "STEP 5: Update Category Status (Cascade Update)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Category updated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    console.log(\"âœ… Step 5: Category status â†’ INACTIVE\");",
                  "    console.log(\"ðŸ”„ RabbitMQ: Updating all products...\");",
                  "    console.log(\"ðŸ“§ Email: Notifying admin...\");",
                  "    console.log(\"\");",
                  "    console.log(\"Expected backend log:\");",
                  "    console.log(\"  ðŸ”„ Xá»­ lÃ½ event: Category status changed\");",
                  "    console.log(\"  âœ… ÄÃ£ cáº­p nháº­t 3 sáº£n pháº©m sang INACTIVE\");",
                  "    console.log(\"  ðŸ“§ ÄÃ£ gá»­i email: 3 products affected\");",
                  "});",
                  "",
                  "setTimeout(function(){}, 3000);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Category (Discontinued)\",\n  \"description\": \"Testing cascade update - All products should be INACTIVE\",\n  \"status\": \"INACTIVE\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/categories/{{test_category_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "categories", "{{test_category_id}}"]
            }
          }
        },
        {
          "name": "STEP 6: Verify Products Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"All test products are INACTIVE\", function () {",
                  "    const products = pm.response.json().content;",
                  "    const categoryId = parseInt(pm.environment.get(\"test_category_id\"));",
                  "    ",
                  "    const categoryProducts = products.filter(p => p.categoryId === categoryId);",
                  "    ",
                  "    let allInactive = true;",
                  "    categoryProducts.forEach(product => {",
                  "        if (product.status !== \"INACTIVE\") {",
                  "            allInactive = false;",
                  "        }",
                  "    });",
                  "    ",
                  "    pm.expect(allInactive).to.be.true;",
                  "    ",
                  "    console.log(\"âœ… Step 6: Verified \" + categoryProducts.length + \" products are INACTIVE\");",
                  "    console.log(\"\");",
                  "    console.log(\"ðŸŽ‰ FULL TEST COMPLETED!\");",
                  "    console.log(\"\");",
                  "    console.log(\"Summary:\");",
                  "    console.log(\"  âœ… Redis Cache: Working (\" + Math.round((1 - pm.environment.get(\"test_first_call_time\") / pm.response.responseTime) * -100) + \"% faster)\");",
                  "    console.log(\"  âœ… RabbitMQ Email: Sent on category creation\");",
                  "    console.log(\"  âœ… RabbitMQ Cascade: Updated \" + categoryProducts.length + \" products\");",
                  "    console.log(\"  âœ… Email Notification: Sent with product count\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/products?page=0&size=100",
              "host": ["{{base_url}}"],
              "path": ["api", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "100"
                }
              ]
            }
          }
        }
      ],
      "description": "ðŸ§ª **Complete Test Flow**\n\nRun all steps **IN ORDER**:\n\n1. **STEP 1:** Login â†’ Get JWT token\n2. **STEP 2:** Create category â†’ RabbitMQ email\n3. **STEP 3:** Create 3 products (run 3 requests)\n4. **STEP 4:** Test Redis cache (run 2 requests)\n5. **STEP 5:** Update category status â†’ Cascade update\n6. **STEP 6:** Verify all products INACTIVE\n\n**Each step has Test Scripts** to auto-verify results.\n\nCheck **Test Results** tab and **Console** for detailed logs."
    }
  ],
  "variable": [
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    }
  ]
}