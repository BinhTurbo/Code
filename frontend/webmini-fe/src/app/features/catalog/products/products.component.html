<div class="page-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <div class="icon-wrapper">
          <svg
            class="header-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
            />
          </svg>
        </div>
        <div>
          <h2 class="page-title">Quản lý sản phẩm</h2>
          <p class="page-subtitle">Danh sách các sản phẩm trong hệ thống</p>
        </div>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-value">{{ total() }}</div>
          <div class="stat-label">Tổng sản phẩm</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Actions Section -->
  <div class="toolbar">
    <div class="search-box">
      <svg class="search-icon" viewBox="0 0 20 20" fill="currentColor">
        <path
          fill-rule="evenodd"
          d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
          clip-rule="evenodd"
        />
      </svg>
      <input
        [(ngModel)]="q"
        placeholder="Tìm kiếm sản phẩm..."
        class="search-input"
        (keyup.enter)="load()"
      />
      <button class="search-btn" (click)="load()">Tìm kiếm</button>
    </div>

    <!-- Export dropdown -->
    <div>
      <button class="btn-export" [matMenuTriggerFor]="exportMenu" title="Xuất dữ liệu">
        <svg class="btn-icon" viewBox="0 0 20 20" fill="currentColor">
          <path d="M3 14a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm7-12a1 1 0 011 1v7.586l2.293-2.293a1 1 0 111.414 1.414l-4 4-.094.083a1 1 0 01-1.32-.083l-4-4a1 1 0 011.414-1.414L9 10.586V3a1 1 0 011-1z"/>
        </svg>
        Xuất
      </button>
      <mat-menu #exportMenu="matMenu">
        <button mat-menu-item (click)="exportProducts('csv')">CSV</button>
        <button mat-menu-item (click)="exportProducts('pdf')">PDF</button>
      </mat-menu>
    </div>

    <button *ngIf="isAdmin()" class="btn-add" (click)="openDialog()">
      <svg class="btn-icon" viewBox="0 0 20 20" fill="currentColor">
        <path
          fill-rule="evenodd"
          d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
          clip-rule="evenodd"
        />
      </svg>
      Thêm sản phẩm
    </button>
  </div>

  <!-- Table Section -->
  <div class="table-container">
    <div class="table-wrapper">
      <table mat-table [dataSource]="rows()" class="custom-table">
        <!-- SKU Column -->
        <ng-container matColumnDef="sku">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">SKU</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
            <span class="cell-sku">{{ r.sku }}</span>
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">Tên sản phẩm</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
            <div class="product-name">
              <div class="product-avatar">
                {{ r.name.charAt(0).toUpperCase() }}
              </div>
              <span class="product-text">{{ r.name }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Category Column -->
        <ng-container matColumnDef="categoryName">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">Danh mục</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
            <span class="category-badge">{{ r.categoryName }}</span>
          </td>
        </ng-container>

        <!-- Price Column -->
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">Giá bán</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
                <span class="price-text"
                >{{ r.price | number : '1.0-0' }} đ</span
                >
          </td>
        </ng-container>

        <!-- Stock Column -->
        <ng-container matColumnDef="stock">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">Tồn kho</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
                <span
                  class="stock-badge"
                  [class.stock-low]="r.stock < 10"
                  [class.stock-medium]="r.stock >= 10 && r.stock < 50"
                  [class.stock-high]="r.stock >= 50"
                >
                  {{ r.stock }}
                </span>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">Trạng thái</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
                <span
                  class="status-badge"
                  [class.status-active]="r.status === 'ACTIVE'"
                  [class.status-inactive]="r.status === 'INACTIVE'"
                >
                  <span class="status-dot"></span>
                  {{ r.status === 'ACTIVE' ? 'Hoạt động' : 'Không hoạt động' }}
                </span>
          </td>
        </ng-container>

        <!-- Action Column -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef class="table-header">
            <span class="header-text">Thao tác</span>
          </th>
          <td mat-cell *matCellDef="let r" class="table-cell">
            <div class="action-buttons" *ngIf="isAdmin()">
              <button
                class="btn-edit"
                (click)="openDialog(r)"
                title="Chỉnh sửa"
              >
                <svg
                  class="action-icon"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                  />
                </svg>
                Sửa
              </button>
              <button class="btn-delete" (click)="remove(r)" title="Xóa">
                <svg
                  class="action-icon"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                    clip-rule="evenodd"
                  />
                </svg>
                Xóa
              </button>
            </div>
            <div class="no-actions" *ngIf="!isAdmin()">
              <span class="text-muted">Không có quyền</span>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="cols"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: cols"
          class="table-row"
        ></tr>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="rows().length === 0">
        <svg
          class="empty-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
          />
        </svg>
        <h3 class="empty-title">Không có sản phẩm nào</h3>
        <p class="empty-text">
          {{
            q
              ? 'Không tìm thấy kết quả phù hợp'
              : 'Bắt đầu bằng cách thêm sản phẩm mới'
          }}
        </p>
        <button
          *ngIf="isAdmin() && !q"
          class="btn-add-empty"
          (click)="openDialog()"
        >
          Thêm sản phẩm đầu tiên
        </button>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-wrapper" *ngIf="rows().length > 0">
      <mat-paginator
        [length]="total()"
        [pageSize]="size()"
        [pageSizeOptions]="[5, 10, 20, 50]"
        (page)="pageChange($event)"
        class="custom-paginator"
      >
      </mat-paginator>
    </div>
  </div>
</div>
