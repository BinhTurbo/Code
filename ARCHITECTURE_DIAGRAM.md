# ğŸ¨ SÆ¡ Äá»“ Kiáº¿n TrÃºc Redis + RabbitMQ

## ğŸ“Š Luá»“ng Dá»¯ Liá»‡u Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Angular Frontend)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP Request
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTROLLER LAYER (Spring Boot)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ CategoryControllerâ”‚         â”‚ ProductControllerâ”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                            â”‚
             â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER (Business Logic)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ CategoryService  â”‚         â”‚  ProductService  â”‚                    â”‚
â”‚  â”‚                  â”‚         â”‚                  â”‚                    â”‚
â”‚  â”‚ @Cacheable       â”‚         â”‚  @Cacheable      â”‚                    â”‚
â”‚  â”‚ @CacheEvict      â”‚         â”‚  @CacheEvict     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                          â”‚
             â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚          â”‚      â”‚        â”‚        â”‚
    â–¼        â–¼          â–¼      â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQL   â”‚ â”‚ Redis  â”‚ â”‚  RabbitMQ  â”‚ â”‚ MySQL   â”‚ â”‚ Redis  â”‚
â”‚ Databaseâ”‚ â”‚ Cache  â”‚ â”‚  Publisher â”‚ â”‚ Databaseâ”‚ â”‚ Cache  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Message Queue
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RabbitMQ Queue  â”‚
                    â”‚  category.queue   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Auto Consume
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CategoryEventListenerâ”‚
                    â”‚  @RabbitListener     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                    â–¼                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ EmailService  â”‚   â”‚ Update       â”‚
            â”‚ Send Email    â”‚   â”‚ Products     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ Status       â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Luá»“ng Xá»­ LÃ½ Chi Tiáº¿t

### Scenario 1: Táº¡o Category Má»›i

```
Step 1: Client táº¡o category
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ POST /api/categories {"name": "Laptop", "status": "ACTIVE"}
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CategoryControllerâ”‚ create(@RequestBody ...)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CategoryService â”‚
â”‚                â”‚
â”‚ 1. Validate    â”‚
â”‚ 2. Save to DB  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Clear Cache â”‚            â”‚
â”‚ 4. Publish     â”‚            â”‚
â”‚    Message     â”‚            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                        â–¼
     â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚   MySQL   â”‚
     â”‚                  â”‚ Database  â”‚
     â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ eventPublisher.publishCategoryCreated(...)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CategoryEventPublisherâ”‚
â”‚ rabbitTemplate     â”‚
â”‚ .convertAndSend()  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Send Message
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RabbitMQ Queue   â”‚
â”‚  category.queue    â”‚
â”‚                    â”‚
â”‚ Message:           â”‚
â”‚ {                  â”‚
â”‚   id: 1,           â”‚
â”‚   name: "Laptop",  â”‚
â”‚   eventType:       â”‚
â”‚     "CREATED",     â”‚
â”‚   status: "ACTIVE" â”‚
â”‚ }                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Auto Consumed
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CategoryEventListener â”‚
â”‚ @RabbitListener      â”‚
â”‚                      â”‚
â”‚ handleCategoryEvent()â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EmailService    â”‚
â”‚                  â”‚
â”‚ sendCategoryCreatedEmail("Laptop")
â”‚                  â”‚
â”‚ âœ‰ï¸  Email sent    â”‚
â”‚ to admin         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result:
âœ… Category saved to DB
âœ… Cache cleared
âœ… Message published to RabbitMQ
âœ… Email sent to admin
```

---

### Scenario 2: Sá»­a Status Category (ACTIVE â†’ INACTIVE)

```
Step 1: Client cáº­p nháº­t category
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ PUT /api/categories/1 {"name": "Laptop", "status": "INACTIVE"}
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CategoryControllerâ”‚ update(id, ...)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CategoryService     â”‚
â”‚                     â”‚
â”‚ 1. Find category    â”‚
â”‚ 2. Check status     â”‚
â”‚    changed?         â”‚
â”‚    ACTIVEâ†’INACTIVE? â”‚
â”‚ 3. Update DB        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Clear Cache      â”‚          â”‚
â”‚ 5. Publish Message  â”‚          â–¼
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                     â”‚   MySQL   â”‚
     â”‚                     â”‚  UPDATE   â”‚
     â”‚                     â”‚ categoriesâ”‚
     â”‚                     â”‚ SET statusâ”‚
     â”‚                     â”‚ = INACTIVEâ”‚
     â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ eventPublisher.publishCategoryStatusChanged(...)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CategoryEventPublisherâ”‚
â”‚ rabbitTemplate     â”‚
â”‚ .convertAndSend()  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Send Message
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RabbitMQ Queue   â”‚
â”‚  category.queue    â”‚
â”‚                    â”‚
â”‚ Message:           â”‚
â”‚ {                  â”‚
â”‚   id: 1,           â”‚
â”‚   name: "Laptop",  â”‚
â”‚   eventType:       â”‚
â”‚     "STATUS_       â”‚
â”‚      CHANGED",     â”‚
â”‚   oldStatus:       â”‚
â”‚     "ACTIVE",      â”‚
â”‚   newStatus:       â”‚
â”‚     "INACTIVE"     â”‚
â”‚ }                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Auto Consumed
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CategoryEventListener    â”‚
â”‚ @RabbitListener          â”‚
â”‚                          â”‚
â”‚ handleCategoryEvent()    â”‚
â”‚                          â”‚
â”‚ 1. Check eventType       â”‚
â”‚ 2. If STATUS_CHANGED     â”‚
â”‚    and ACTIVEâ†’INACTIVE   â”‚
â”‚    then update products  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â”‚ updateProductsStatus(categoryId)
     â”‚        â”‚
     â”‚        â–¼
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  â”‚ ProductRepository   â”‚
     â”‚  â”‚ findAllByCategoryId â”‚
     â”‚  â”‚                     â”‚
     â”‚  â”‚ For each product:   â”‚
     â”‚  â”‚   if ACTIVE         â”‚
     â”‚  â”‚     set INACTIVE    â”‚
     â”‚  â”‚                     â”‚
     â”‚  â”‚ saveAll()           â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚         â”‚
     â”‚         â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚   MySQL   â”‚
     â”‚   â”‚  UPDATE   â”‚
     â”‚   â”‚ products  â”‚
     â”‚   â”‚ SET statusâ”‚
     â”‚   â”‚ = INACTIVEâ”‚
     â”‚   â”‚ WHERE     â”‚
     â”‚   â”‚ category  â”‚
     â”‚   â”‚  _id = 1  â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ sendCategoryStatusChangedEmail(...)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EmailService    â”‚
â”‚                  â”‚
â”‚ âœ‰ï¸  Email sent    â”‚
â”‚ to admin:        â”‚
â”‚ "Category Laptop â”‚
â”‚  ACTIVEâ†’INACTIVE â”‚
â”‚  3 products      â”‚
â”‚  affected"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result:
âœ… Category status updated to INACTIVE
âœ… All products of category updated to INACTIVE
âœ… Cache cleared (both categories & products)
âœ… Email sent to admin with details
```

---

## ğŸ” Redis Cache Flow

### Cache Hit (CÃ³ trong cache)

```
Client Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ search(q="laptop")
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductService   â”‚
â”‚ @Cacheable       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Check Cache First
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache      â”‚
â”‚                  â”‚
â”‚ Key:             â”‚
â”‚ "products::      â”‚
â”‚  laptop_null_    â”‚
â”‚  null_ACTIVE_    â”‚
â”‚  null_0_10"      â”‚
â”‚                  â”‚
â”‚ âœ… FOUND!         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Return cached data
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller   â”‚  Return to client (FAST! ~5ms)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cache Miss (KhÃ´ng cÃ³ trong cache)

```
Client Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ search(q="laptop")
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductService   â”‚
â”‚ @Cacheable       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Check Cache First
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache      â”‚
â”‚                  â”‚
â”‚ âŒ NOT FOUND!     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Execute method
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Query   â”‚
â”‚ SELECT * FROM    â”‚
â”‚ products WHERE   â”‚
â”‚ name LIKE        â”‚
â”‚ '%laptop%'       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Results
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductService   â”‚
â”‚ Save to Cache    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache      â”‚
â”‚ SET key=         â”‚
â”‚ "products::..."  â”‚
â”‚ value=results    â”‚
â”‚ TTL=600s         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Return results
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller   â”‚  Return to client (SLOW first time ~100ms)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      (FAST next time ~5ms)
```

### Cache Eviction (XÃ³a cache)

```
Client Request: Create/Update/Delete Product
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ create(...)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductService   â”‚
â”‚ @CacheEvict      â”‚
â”‚ (allEntries=true)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Save to DB
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Clear ALL cache in "products"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache      â”‚
â”‚                  â”‚
â”‚ DELETE all keys  â”‚
â”‚ matching:        â”‚
â”‚ "products::*"    â”‚
â”‚                  â”‚
â”‚ âœ… Cache cleared  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Next search request will query DB and rebuild cache
```

---

## ğŸ“¨ RabbitMQ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RabbitMQ Broker                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚          Exchange: category.exchange           â”‚        â”‚
â”‚  â”‚              Type: TOPIC                        â”‚        â”‚
â”‚  â”‚                                                  â”‚        â”‚
â”‚  â”‚  Routing Key Pattern: "category.*"             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚               â”‚               â”‚                            â”‚
â”‚               â”‚               â”‚                            â”‚
â”‚  Routing Key: â”‚               â”‚ Routing Key:              â”‚
â”‚  "category.   â”‚               â”‚ "category.                â”‚
â”‚   created"    â”‚               â”‚  status.changed"          â”‚
â”‚               â”‚               â”‚                            â”‚
â”‚               â–¼               â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚      Queue: category.queue                 â”‚            â”‚
â”‚  â”‚      (Durable: true)                       â”‚            â”‚
â”‚  â”‚                                             â”‚            â”‚
â”‚  â”‚  Messages:                                 â”‚            â”‚
â”‚  â”‚  [1] {id:1, name:"Laptop", type:"CREATED"} â”‚            â”‚
â”‚  â”‚  [2] {id:2, name:"Phone", type:"STATUS_..."}â”‚           â”‚
â”‚  â”‚  [3] ...                                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                       â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Consume (Auto-acknowledge)
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚CategoryEventListenerâ”‚
              â”‚  @RabbitListener    â”‚
              â”‚                     â”‚
              â”‚ Process message:    â”‚
              â”‚ - Send email        â”‚
              â”‚ - Update products   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Annotations Explained

### @Cacheable

```java
@Cacheable(value = "products", key = "#id")
public ProductResponse get(Long id) {
    // Chá»‰ cháº¡y náº¿u cache MISS
    return productRepository.findById(id);
}

// Redis sáº½ lÆ°u:
// Key: products::123
// Value: {id: 123, name: "Laptop", ...}
```

### @CacheEvict

```java
@CacheEvict(value = "products", allEntries = true)
public void create(ProductCreateRequest req) {
    // Sau khi lÆ°u DB, xÃ³a Táº¤T Cáº¢ cache "products"
    productRepository.save(...);
}

// Redis sáº½ xÃ³a:
// products::*  (táº¥t cáº£ keys báº¯t Ä‘áº§u vá»›i "products::")
```

### @RabbitListener

```java
@RabbitListener(queues = "category.queue")
public void handleEvent(CategoryEventMessage msg) {
    // Tá»± Ä‘á»™ng láº¥y message tá»« queue vÃ  xá»­ lÃ½
    // Náº¿u method cháº¡y thÃ nh cÃ´ng â†’ message bá»‹ xÃ³a khá»i queue
    // Náº¿u exception â†’ message cÃ³ thá»ƒ retry hoáº·c vÃ o DLQ
}
```

---

## ğŸ“ˆ Performance Comparison

### Without Cache (Trá»±c tiáº¿p query DB)

```
Request 1: â”€â”€â”
Request 2:   â”œâ”€â†’ All hit Database (100ms each)
Request 3:   â”‚
Request 4: â”€â”€â”˜
Total: 400ms for 4 requests
```

### With Redis Cache

```
Request 1: â”€â”€â†’ Database (100ms) â”€â”€â†’ Cache to Redis
Request 2: â”€â”€â†’ Redis (5ms)
Request 3: â”€â”€â†’ Redis (5ms)
Request 4: â”€â”€â†’ Redis (5ms)
Total: 115ms for 4 requests (71% faster!)
```

---

## ğŸ” Security Notes

### Redis

- **Production:** ThÃªm password cho Redis
- **Production:** KhÃ´ng expose port 6379 ra ngoÃ i

### RabbitMQ

- **Production:** Äá»•i username/password máº·c Ä‘á»‹nh
- **Production:** Cáº¥u hÃ¬nh SSL/TLS

### Email

- **KHÃ”NG BAO GIá»œ** commit password vÃ o Git
- DÃ¹ng Environment Variables hoáº·c Secret Manager

---

ChÃºc báº¡n há»c tá»‘t! ğŸš€
